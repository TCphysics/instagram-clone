{"ast":null,"code":"import _slicedToArray from\"/Users/chentang/instagram_clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import firebase from\"firebase\";import{storage,db}from\"./firebase\";import{Input,Button}from\"@material-ui/core\";import\"./imageUpload.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ImageUpload(_ref){var username=_ref.username;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),image=_useState2[0],setImage=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),url=_useState4[0],setUrl=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),caption=_useState8[0],setCaption=_useState8[1];var handleChange=function handleChange(event){if(event.target.files[0]){setImage(event.target.files[0]);}};// visualize imageupload progress bar\nvar handleUpload=function handleUpload(){var uploadTask=storage.ref(\"images/\".concat(image.name)).put(image);uploadTask.on(\"state_changed\",function(snapshot){// progress function ...\nvar progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){// Error function ...\nalert(error.message);},function(){// complete function ...\nstorage.ref(\"images\").child(image.name).getDownloadURL().then(function(url){setUrl(url);// post the uploaded image inside firebase\ndb.collection(\"posts\").add({caption:caption,imageUrl:url,username:username,// make the newest upload image at the top\ntimestamp:firebase.firestore.FieldValue.serverTimestamp()});// reset the upload component\nsetProgress(0);setCaption(\"\");setImage(null);});});};return/*#__PURE__*/_jsxs(\"div\",{className:\"imageupload\",children:[/*#__PURE__*/_jsx(\"progress\",{className:\"imageupload__progress\",value:progress,max:\"100\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"Enter a caption here!\",value:caption,onChange:function onChange(e){return setCaption(e.target.value);}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:handleChange}),/*#__PURE__*/_jsx(Button,{className:\"imageupload__button\",onClick:handleUpload,children:\"Upload\"})]}),/*#__PURE__*/_jsx(\"br\",{})]});};export default ImageUpload;","map":{"version":3,"sources":["/Users/chentang/instagram_clone/src/imageUpload.js"],"names":["React","useState","firebase","storage","db","Input","Button","ImageUpload","username","image","setImage","url","setUrl","progress","setProgress","caption","setCaption","handleChange","event","target","files","handleUpload","uploadTask","ref","name","put","on","snapshot","Math","round","bytesTransferred","totalBytes","error","alert","message","child","getDownloadURL","then","collection","add","imageUrl","timestamp","firestore","FieldValue","serverTimestamp","e","value"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport firebase from \"firebase\";\nimport { storage, db } from \"./firebase\";\nimport { Input, Button } from \"@material-ui/core\";\nimport \"./imageUpload.css\";\n\nfunction ImageUpload({ username }) {\n    const [image, setImage] = useState(null);\n    const [url, setUrl] = useState(\"\");\n    const [progress, setProgress] = useState(0);\n    const [caption, setCaption] = useState('');\n\n    const handleChange = (event) => {\n        if (event.target.files[0]) {\n            setImage(event.target.files[0]);\n        }\n    };\n\n    // visualize imageupload progress bar\n    const handleUpload = () => {\n        const uploadTask = storage.ref(`images/${image.name}`).put(image);\n        uploadTask.on(\n            \"state_changed\",\n            (snapshot) => {\n                // progress function ...\n                const progress = Math.round(\n                    (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n                );\n                setProgress(progress);\n            },\n            (error) => {\n                // Error function ...\n                alert(error.message);\n            },\n            () => {\n                // complete function ...\n                storage\n                    .ref(\"images\")\n                    .child(image.name)\n                    .getDownloadURL()\n                    .then((url) => {\n                        setUrl(url);\n\n                        // post the uploaded image inside firebase\n                        db.collection(\"posts\").add({\n                            caption: caption,\n                            imageUrl: url,\n                            username: username,\n                            // make the newest upload image at the top\n                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n                        });\n\n                        // reset the upload component\n                        setProgress(0);\n                        setCaption(\"\");\n                        setImage(null);\n                    });\n            }\n        );\n    };\n\n    return (\n        <div className=\"imageupload\">\n          <progress className=\"imageupload__progress\" value={progress} max=\"100\" />\n          <Input\n            placeholder=\"Enter a caption here!\"\n            value={caption}\n            onChange={(e) => setCaption(e.target.value)}\n          />\n          <div>\n            <input type=\"file\" onChange={handleChange} />\n            <Button className=\"imageupload__button\" onClick={handleUpload}>\n              Upload\n            </Button>\n          </div>\n    \n          <br />\n        </div>\n      );\n};\n\nexport default ImageUpload;\n"]},"metadata":{},"sourceType":"module"}